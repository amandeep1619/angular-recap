<div class="p-4 sm:p-8 max-w-5xl mx-auto min-h-screen">
  
  <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-8 gap-6">
    <div class="flex-1 w-full">
      <div class="flex items-center gap-2 mb-2">
        <span class="text-[10px] font-black text-indigo-600 uppercase tracking-widest bg-indigo-50 px-2 py-1 rounded">
          {{ mode === 'view' ? 'Reading Mode' : (mode === 'edit' ? 'Editing Note' : 'New Note') }}
        </span>
      </div>
      <input 
        [(ngModel)]="title" 
        [disabled]="mode === 'view'"
        placeholder="Untitled Note" 
        class="w-full text-3xl sm:text-5xl font-black bg-transparent border-none outline-none text-slate-900 placeholder:text-slate-200 disabled:opacity-100 disabled:text-slate-900 transition-all"
      />
    </div>
    
    <div class="flex items-center gap-3 w-full sm:w-auto">
      <button (click)="goBack()" class="flex-1 sm:flex-none px-6 py-3.5 text-slate-500 font-bold hover:bg-slate-100 rounded-2xl transition-all">
        {{ mode === 'view' ? 'Back' : 'Cancel' }}
      </button>

      <button 
        *ngIf="mode !== 'view'"
        (click)="saveNote()" 
        [disabled]="isSaving || !title.trim()"
        class="flex-1 sm:flex-none bg-indigo-600 text-white px-8 py-3.5 rounded-2xl font-bold shadow-lg shadow-indigo-100 hover:bg-indigo-700 active:scale-95 disabled:opacity-50 transition-all flex items-center justify-center gap-2"
      >
        <lucide-icon [name]="isSaving ? 'loader-2' : 'check'" [size]="20" [class.animate-spin]="isSaving"></lucide-icon>
        Save Note
      </button>

      <button 
        *ngIf="mode === 'view' && isOwner"
        (click)="toggleEdit()"
        class="flex-1 sm:flex-none bg-slate-900 text-white px-8 py-3.5 rounded-2xl font-bold shadow-xl hover:bg-indigo-600 transition-all flex items-center justify-center gap-2"
      >
        <lucide-icon name="edit-3" [size]="20"></lucide-icon>
        Edit Note
      </button>
    </div>
  </div>

  <div class="relative">
    @if (editor) {
      <div class="bg-white border border-slate-200 rounded-[24px] sm:rounded-[32px] overflow-hidden transition-all shadow-sm"
           [ngClass]="{
             'ring-4 ring-indigo-50 border-indigo-300': mode !== 'view', 
             'bg-slate-50/30 select-none pointer-events-none': mode === 'view'
           }">
        
        <div *ngIf="mode !== 'view'" class="border-b border-slate-100 bg-slate-50/50">
          <ngx-editor-menu [editor]="editor" [toolbar]="toolbar"></ngx-editor-menu>
        </div>
        
        <div class="p-4 sm:p-8 min-h-[600px] prose prose-slate max-w-none">
          <ngx-editor
            [editor]="editor"
            [(ngModel)]="content"
            [placeholder]="mode === 'view' ? '' : 'Start your note...'"
          ></ngx-editor>
        </div>
      </div>
    }
  </div>
</div>